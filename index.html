<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Fitness Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .form-section {
            margin-bottom: 2rem; /* Increased spacing */
            padding-bottom: 1.5rem; /* Add padding for border */
            border-bottom: 1px solid #e5e7eb; /* gray-200 */
        }
        .form-section:last-of-type {
            border-bottom: none; /* No border for the last section */
            margin-bottom: 1.5rem;
        }
        .form-section h2 {
            font-size: 1.5rem; /* Slightly larger section titles */
            font-weight: 700; /* Bolder */
            margin-bottom: 1.5rem; /* Increased spacing */
            color: #111827; /* gray-900 */
            display: flex;
            align-items: center;
        }
        .form-section h2 .step-icon {
            margin-right: 0.75rem;
            color: #2563eb; /* blue-600 */
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151; /* gray-700 */
        }
        input[type="text"], input[type="number"], select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            box-shadow: inset 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        input[type="text"]:focus, input[type="number"]:focus, select:focus, textarea:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            border-color: #2563eb; /* blue-600 */
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); /* blue-300 with opacity */
        }
        textarea {
            min-height: 80px;
        }
        .checkbox-group label, .radio-group label {
            font-weight: 400; /* Normal weight for checkbox/radio option labels */
            margin-left: 0.5rem;
        }
        .checkbox-item, .radio-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        input[type="checkbox"], input[type="radio"] {
            width: 1rem;
            height: 1rem;
            border-radius: 0.25rem;
            border-color: #d1d5db; /* gray-300 */
            color: #2563eb; /* blue-600 */
        }
        input[type="checkbox"]:focus, input[type="radio"]:focus {
            ring: 2px;
            ring-offset: 2px;
            ring-color: #2563eb; /* blue-600 */
        }

        .btn {
            padding: 0.875rem 1.75rem; /* Slightly larger button */
            border-radius: 0.5rem; /* rounded-lg */
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
        }
        .btn:active {
            transform: translateY(1px);
        }
        .btn-primary {
            background-color: #2563eb; /* blue-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .btn-primary:hover {
            background-color: #1d4ed8; /* blue-700 */
        }
        .message-box {
            padding: 1rem;
            margin-top: 1.5rem; /* Increased spacing */
            border-radius: 0.5rem; /* rounded-lg */
            font-size: 0.9rem; 
        }
        .message-box.error {
            background-color: #fee2e2; /* red-100 */
            color: #b91c1c; /* red-700 */
            border: 1px solid #fecaca; /* red-300 */
        }
        .message-box.success {
            background-color: #dcfce7; /* green-100 */
            color: #15803d; /* green-700 */
            border: 1px solid #bbf7d0; /* green-300 */
        }
        .message-box.loading {
            background-color: #e0f2fe; /* light blue-100 */
            color: #075985; /* light blue-700 */
            border: 1px solid #bae6fd; /* light blue-300 */
        }
        .plan-card {
            background-color: white;
            border: 1px solid #e5e7eb; /* gray-200 */
            border-radius: 0.75rem; /* rounded-xl */
            padding: 1.75rem; /* Increased padding */
            margin-bottom: 1.5rem; /* Increased spacing */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -2px rgba(0, 0, 0, 0.07);
        }
        .plan-card h3 {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600;
            margin-bottom: 0.75rem;
        }
        .plan-card h4 {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600;
            margin-top: 1.25rem;
            margin-bottom: 0.75rem;
            color: #1e3a8a; /* blue-800 */
        }
        .exercise-item {
            padding: 0.75rem 0.5rem; /* Adjusted padding */
            border-bottom: 1px solid #f3f4f6; /* gray-100 */
        }
        .exercise-item:last-child {
            border-bottom: none;
        }
        .settings-bar {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem;
            z-index: 10; /* Ensure it's above other content */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-8 px-4 relative">

    <!-- Settings Placeholder -->
    <div class="settings-bar">
        <select id="languageSetting" name="languageSetting" class="p-2 border border-gray-300 rounded-md text-sm bg-white shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
            <option value="en">English</option>
            <option value="fa">ŸÅÿßÿ±ÿ≥€å (Persian)</option>
            <!-- Add more languages here as needed -->
        </select>
    </div>

    <div class="w-full max-w-3xl bg-white p-6 sm:p-10 rounded-xl shadow-2xl">
        <header class="mb-10 text-center">
            <h1 class="text-4xl sm:text-5xl font-bold text-gray-800" data-translate-key="appTitle">AI Fitness Planner</h1>
            <p class="text-gray-600 mt-3 text-lg" data-translate-key="appSubtitle">Your Personalized Workout Journey Starts Here</p>
        </header>

        <!-- API Key Input -->
        <div class="mb-8 p-4 border border-amber-400 bg-amber-50 rounded-lg shadow-sm">
            <label for="apiKey" class="block text-sm font-medium text-amber-700 mb-1" data-translate-key="apiKeyLabel">Gemini API Key (Optional)</label>
            <input type="text" id="apiKey" name="apiKey" class="w-full p-2 border border-amber-500 rounded-md shadow-sm placeholder-amber-400" placeholder="Enter your Gemini API Key if using models other than gemini-2.0-flash or gemini-2.5-flash-preview-05-20" data-translate-key="apiKeyPlaceholder">
            <p class="text-xs text-amber-600 mt-1" data-translate-key="apiKeyNote">For `gemini-2.0-flash` or `gemini-2.5-flash-preview-05-20`, the key is often handled by the environment. Provide if you intend to switch models or if prompted.</p>
        </div>

        <!-- Form Section -->
        <form id="fitnessForm" class="space-y-8">
            <div class="form-section">
                <h2 class="border-b-0"><span class="step-icon">üë§</span><span data-translate-key="step1Title">Step 1: Basic Information</span></h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mt-4">
                    <div>
                        <label for="age" data-translate-key="ageLabel">Age (10-99):</label>
                        <input type="number" id="age" name="age" min="10" max="99" required class="mt-1">
                    </div>
                    <div>
                        <label for="gender" data-translate-key="genderLabel">Gender:</label>
                        <select id="gender" name="gender" required class="mt-1">
                            <option value="Male" data-translate-key="genderMale">Male</option>
                            <option value="Female" data-translate-key="genderFemale">Female</option>
                            <option value="Other" data-translate-key="genderOther">Other/Prefer not to say</option>
                        </select>
                    </div>
                    <div>
                        <label for="height" data-translate-key="heightLabel">Height (cm, 100-250):</label>
                        <input type="number" id="height" name="height" min="100" max="250" required class="mt-1">
                    </div>
                    <div>
                        <label for="weight" data-translate-key="weightLabel">Weight (kg, 30-200):</label>
                        <input type="number" id="weight" name="weight" min="30" max="200" required class="mt-1">
                    </div>
                     <div>
                        <label for="activityLevel" data-translate-key="activityLevelLabel">Activity Level (Daily):</label>
                        <select id="activityLevel" name="activityLevel" required class="mt-1">
                            <option value="Sedentary" data-translate-key="activitySedentary">Sedentary (little or no exercise)</option>
                            <option value="Lightly Active" data-translate-key="activityLightly">Lightly Active (light exercise/sports 1-3 days/week)</option>
                            <option value="Moderately Active" data-translate-key="activityModerately">Moderately Active (moderate exercise/sports 3-5 days/week)</option>
                            <option value="Very Active" data-translate-key="activityVery">Very Active (hard exercise/sports 6-7 days a week)</option>
                            <option value="Extra Active" data-translate-key="activityExtra">Extra Active (very hard exercise/sports & physical job)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="border-b-0"><span class="step-icon">üéØ</span><span data-translate-key="step2Title">Step 2: Goals & General Preferences</span></h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4 mt-4">
                    <div>
                        <label for="goal" data-translate-key="goalLabel">Primary Goal:</label>
                        <select id="goal" name="goal" required class="mt-1">
                            <option value="Fat Loss" data-translate-key="goalFatLoss">Fat Loss</option>
                            <option value="Muscle Gain" data-translate-key="goalMuscleGain">Muscle Gain</option>
                            <option value="Endurance" data-translate-key="goalEndurance">Endurance Improvement</option>
                            <option value="Flexibility" data-translate-key="goalFlexibility">Flexibility & Mobility</option>
                            <option value="General Health" data-translate-key="goalGeneralHealth">General Health & Fitness</option>
                        </select>
                    </div>
                     <div>
                        <label for="timeframe" data-translate-key="timeframeLabel">Timeframe for Goal (e.g., 4 weeks, 3 months):</label>
                        <input type="text" id="timeframe" name="timeframe" placeholder="e.g., 8 weeks" required class="mt-1" data-translate-key="timeframePlaceholder">
                    </div>
                    <div>
                        <label for="experienceLevel" data-translate-key="experienceLabel">Exercise Experience Level:</label>
                        <select id="experienceLevel" name="experienceLevel" required class="mt-1">
                            <option value="Beginner" data-translate-key="expBeginner">Beginner (New to exercise or returning after a long break)</option>
                            <option value="Intermediate" data-translate-key="expIntermediate">Intermediate (Consistent exercise for 6+ months)</option>
                            <option value="Advanced" data-translate-key="expAdvanced">Advanced (Consistent, structured training for 1+ year)</option>
                        </select>
                    </div>
                    <div>
                        <label for="daysPerWeek" data-translate-key="daysPerWeekLabel">Workout Days Per Week (1-7):</label>
                        <input type="number" id="daysPerWeek" name="daysPerWeek" min="1" max="7" required class="mt-1">
                    </div>
                    <div>
                        <label for="sessionDuration" data-translate-key="sessionDurationLabel">Max Duration Per Session (minutes, 20-120):</label>
                        <input type="number" id="sessionDuration" name="sessionDuration" min="20" max="120" step="5" required class="mt-1">
                    </div>
                    <div>
                        <label for="equipment" data-translate-key="equipmentLabel">Equipment Availability:</label>
                        <select id="equipment" name="equipment" required class="mt-1">
                            <option value="None" data-translate-key="equipNone">None (Bodyweight only)</option>
                            <option value="Basic" data-translate-key="equipBasic">Basic (Dumbbells, Resistance Bands)</option>
                            <option value="Full Gym" data-translate-key="equipFullGym">Full Gym Access</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h2 class="border-b-0"><span class="step-icon">‚öôÔ∏è</span><span data-translate-key="step3Title">Step 3: Advanced Customization</span></h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6 mt-4">
                    <div>
                        <label data-translate-key="preferredTypesLabel">Preferred Exercise Types:</label>
                        <div class="mt-2 space-y-2 checkbox-group">
                            <div class="checkbox-item"><input type="checkbox" id="typeCardio" name="preferredTypes" value="Cardio"><label for="typeCardio" data-translate-key="typeCardio">Cardio (Running, Cycling, etc.)</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="typeStrength" name="preferredTypes" value="Strength Training"><label for="typeStrength" data-translate-key="typeStrength">Strength Training (Weights)</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="typeBodyweight" name="preferredTypes" value="Bodyweight"><label for="typeBodyweight" data-translate-key="typeBodyweight">Bodyweight Exercises</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="typeYogaPilates" name="preferredTypes" value="Yoga/Pilates"><label for="typeYogaPilates" data-translate-key="typeYogaPilates">Yoga / Pilates</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="typeHIIT" name="preferredTypes" value="HIIT"><label for="typeHIIT" data-translate-key="typeHIIT">HIIT (High-Intensity Interval Training)</label></div>
                        </div>
                    </div>
                    <div>
                        <label data-translate-key="focusAreasLabel">Focus Areas (Optional):</label>
                        <div class="mt-2 space-y-2 checkbox-group">
                            <div class="checkbox-item"><input type="checkbox" id="focusUpper" name="focusAreas" value="Upper Body"><label for="focusUpper" data-translate-key="focusUpper">Upper Body</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="focusLower" name="focusAreas" value="Lower Body"><label for="focusLower" data-translate-key="focusLower">Lower Body</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="focusCore" name="focusAreas" value="Core"><label for="focusCore" data-translate-key="focusCore">Core Strength</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="focusFlexibility" name="focusAreas" value="Flexibility/Mobility"><label for="focusFlexibility" data-translate-key="focusFlexibility">Flexibility / Mobility</label></div>
                            <div class="checkbox-item"><input type="checkbox" id="focusBalance" name="focusAreas" value="Balance"><label for="focusBalance" data-translate-key="focusBalance">Balance</label></div>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                    <label for="limitations" data-translate-key="limitationsLabel">Physical Limitations or Injuries (if any):</label>
                    <textarea id="limitations" name="limitations" placeholder="e.g., sensitive knees, past shoulder injury. Be specific." class="mt-1" data-translate-key="limitationsPlaceholder"></textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6 mt-6">
                     <div>
                        <label for="structuringStyle" data-translate-key="structuringStyleLabel">Workout Structuring Style:</label>
                        <select id="structuringStyle" name="structuringStyle" class="mt-1">
                            <option value="Full Body" data-translate-key="styleFullBody">Full Body Routines</option>
                            <option value="Split Routines" data-translate-key="styleSplit">Split Routines (e.g., Push/Pull/Legs, Upper/Lower)</option>
                            <option value="Flexible Mix" data-translate-key="styleFlexible">Flexible Mix (AI to decide best structure)</option>
                        </select>
                    </div>
                    <div class="space-y-3">
                        <div class="checkbox-item mt-1">
                            <input type="checkbox" id="includeWarmupCooldown" name="includeWarmupCooldown" value="Yes" checked>
                            <label for="includeWarmupCooldown" class="ml-2" data-translate-key="includeWarmupCooldownLabel">Include Warm-up & Cool-down suggestions?</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="includeNutrition" name="includeNutrition" value="Yes">
                            <label for="includeNutrition" class="ml-2" data-translate-key="includeNutritionLabel">Request basic nutrition guidelines summary?</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <button type="submit" id="generatePlanBtn" class="w-full btn btn-primary text-lg">
                <span data-translate-key="generatePlanBtnText">‚ú® Generate My Personalized Plan ‚ú®</span>
            </button>
        </form>

        <!-- Message Display Area -->
        <div id="messageArea" class="mt-8"></div>

        <!-- Plan Display Area -->
        <div id="planResultArea" class="mt-10 hidden">
            <h2 class="text-3xl font-semibold text-gray-800 mb-8 text-center" data-translate-key="planResultTitle">Your Personalized Workout Plan</h2>
            <div id="planContent" class="space-y-6">
                <!-- Plan will be rendered here -->
            </div>
        </div>
    </div>

    <footer class="mt-16 mb-8 text-center text-sm text-gray-500">
        <p data-translate-key="footerCopyright">&copy; 2025 AI Fitness Planner. Powered by Gemini.</p>
        <p data-translate-key="footerDisclaimer">This is a demo application. Consult a healthcare professional before starting any new fitness program.</p>
    </footer>

    <script>
        // --- Configuration & Constants ---
        const GEMINI_API_BASE_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent";
        
        // --- DOM Elements ---
        const fitnessForm = document.getElementById('fitnessForm');
        const generatePlanBtn = document.getElementById('generatePlanBtn');
        const messageArea = document.getElementById('messageArea');
        const planResultArea = document.getElementById('planResultArea');
        const planContent = document.getElementById('planContent');
        const apiKeyInput = document.getElementById('apiKey');
        const languageSetting = document.getElementById('languageSetting');

        // --- Basic Translation Data (Placeholder) ---
        const translations = {
            en: {
                appTitle: "AI Fitness Planner",
                appSubtitle: "Your Personalized Workout Journey Starts Here",
                apiKeyLabel: "Gemini API Key (Optional)",
                apiKeyPlaceholder: "Enter your Gemini API Key if using models other than gemini-2.0-flash or gemini-2.5-flash-preview-05-20",
                apiKeyNote: "For `gemini-2.0-flash` or `gemini-2.5-flash-preview-05-20`, the key is often handled by the environment. Provide if you intend to switch models or if prompted.",
                step1Title: "Step 1: Basic Information",
                ageLabel: "Age (10-99):",
                genderLabel: "Gender:",
                genderMale: "Male",
                genderFemale: "Female",
                genderOther: "Other/Prefer not to say",
                heightLabel: "Height (cm, 100-250):",
                weightLabel: "Weight (kg, 30-200):",
                activityLevelLabel: "Activity Level (Daily):",
                activitySedentary: "Sedentary (little or no exercise)",
                activityLightly: "Lightly Active (light exercise/sports 1-3 days/week)",
                activityModerately: "Moderately Active (moderate exercise/sports 3-5 days/week)",
                activityVery: "Very Active (hard exercise/sports 6-7 days a week)",
                activityExtra: "Extra Active (very hard exercise/sports & physical job)",
                step2Title: "Step 2: Goals & General Preferences",
                goalLabel: "Primary Goal:",
                goalFatLoss: "Fat Loss",
                goalMuscleGain: "Muscle Gain",
                goalEndurance: "Endurance Improvement",
                goalFlexibility: "Flexibility & Mobility",
                goalGeneralHealth: "General Health & Fitness",
                timeframeLabel: "Timeframe for Goal (e.g., 4 weeks, 3 months):",
                timeframePlaceholder: "e.g., 8 weeks",
                experienceLabel: "Exercise Experience Level:",
                expBeginner: "Beginner (New to exercise or returning after a long break)",
                expIntermediate: "Intermediate (Consistent exercise for 6+ months)",
                expAdvanced: "Advanced (Consistent, structured training for 1+ year)",
                daysPerWeekLabel: "Workout Days Per Week (1-7):",
                sessionDurationLabel: "Max Duration Per Session (minutes, 20-120):",
                equipmentLabel: "Equipment Availability:",
                equipNone: "None (Bodyweight only)",
                equipBasic: "Basic (Dumbbells, Resistance Bands)",
                equipFullGym: "Full Gym Access",
                step3Title: "Step 3: Advanced Customization",
                preferredTypesLabel: "Preferred Exercise Types:",
                typeCardio: "Cardio (Running, Cycling, etc.)",
                typeStrength: "Strength Training (Weights)",
                typeBodyweight: "Bodyweight Exercises",
                typeYogaPilates: "Yoga / Pilates",
                typeHIIT: "HIIT (High-Intensity Interval Training)",
                focusAreasLabel: "Focus Areas (Optional):",
                focusUpper: "Upper Body",
                focusLower: "Lower Body",
                focusCore: "Core Strength",
                focusFlexibility: "Flexibility / Mobility",
                focusBalance: "Balance",
                limitationsLabel: "Physical Limitations or Injuries (if any):",
                limitationsPlaceholder: "e.g., sensitive knees, past shoulder injury. Be specific.",
                structuringStyleLabel: "Workout Structuring Style:",
                styleFullBody: "Full Body Routines",
                styleSplit: "Split Routines (e.g., Push/Pull/Legs, Upper/Lower)",
                styleFlexible: "Flexible Mix (AI to decide best structure)",
                includeWarmupCooldownLabel: "Include Warm-up & Cool-down suggestions?",
                includeNutritionLabel: "Request basic nutrition guidelines summary?",
                generatePlanBtnText: "‚ú® Generate My Personalized Plan ‚ú®",
                planResultTitle: "Your Personalized Workout Plan",
                footerCopyright: "&copy; 2025 AI Fitness Planner. Powered by Gemini.",
                footerDisclaimer: "This is a demo application. Consult a healthcare professional before starting any new fitness program.",
                generatingPlanMsg: "üßò Generating your personalized plan... This might take a moment.",
                errorFieldsMsg: "Oops! Please fill out all required fields correctly.",
                successPlanMsg: "üöÄ Workout plan generated successfully! Scroll down to see it.",
                errorApiMsg: "Error: {errorMessage}. Please check your inputs or API key and try again.",
                planOverviewTitle: "üìã Plan Overview",
                totalWeeksText: "Total Weeks:",
                workoutsPerWeekText: "Workouts Per Week:",
                warmupTitle: "Warm-up Routine",
                cooldownTitle: "Cool-down Routine",
                nutritionTitle: "üçé Basic Nutrition Guidelines",
                caloriesEstimateText: "Estimated Daily Calories:",
                macroBreakdownText: "Macro Breakdown (P/C/F):",
                generalAdviceText: "General Advice:",
                noExercisesText: "No specific exercises listed for this day.",
                restDayText: "üòå This is a designated rest day. Enjoy your recovery!",
                focusText: "Focus:",
                exercisesTitle: "Exercises:",
                setsText: "Sets:",
                repsDurationText: "Reps/Duration:",
                restText: "Rest:",
                noteText: "üí° Note:",
                noPlanDataMsg: "Could not retrieve plan data.",
                noWorkoutDaysMsg: "No workout days were specified in the generated plan."

            },
            fa: {
                appTitle: "ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤ ÿ™ŸÜÿßÿ≥ÿ® ÿßŸÜÿØÿßŸÖ ŸáŸàÿ¥ ŸÖÿµŸÜŸàÿπ€å",
                appSubtitle: "ÿ≥ŸÅÿ± ÿ™ŸÖÿ±€åŸÜ€å ÿ¥ÿÆÿµ€å ÿ¥ŸÖÿß ÿßÿ≤ ÿß€åŸÜÿ¨ÿß ÿ¥ÿ±Ÿàÿπ ŸÖ€å‚Äåÿ¥ŸàÿØ",
                apiKeyLabel: "⁄©ŸÑ€åÿØ API Gemini (ÿßÿÆÿ™€åÿßÿ±€å)",
                apiKeyPlaceholder: "⁄©ŸÑ€åÿØ API Gemini ÿÆŸàÿØ ÿ±ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ (ÿß⁄Øÿ± ÿßÿ≤ ŸÖÿØŸÑ€å ÿ∫€åÿ± ÿßÿ≤ gemini-2.0-flash €åÿß gemini-2.5-flash-preview-05-20 ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äå⁄©ŸÜ€åÿØ)",
                apiKeyNote: "ÿ®ÿ±ÿß€å `gemini-2.0-flash` €åÿß `gemini-2.5-flash-preview-05-20`ÿå ⁄©ŸÑ€åÿØ ÿßÿ∫ŸÑÿ® ÿ™Ÿàÿ≥ÿ∑ ŸÖÿ≠€åÿ∑ ŸÖÿØ€åÿ±€åÿ™ ŸÖ€å‚Äåÿ¥ŸàÿØ. ÿØÿ± ÿµŸàÿ±ÿ™ ÿ™ÿ∫€å€åÿ± ŸÖÿØŸÑ €åÿß ÿØÿ±ÿÆŸàÿßÿ≥ÿ™ÿå ÿßÿ±ÿßÿ¶Ÿá ÿØŸá€åÿØ.",
                step1Title: "ŸÖÿ±ÿ≠ŸÑŸá €±: ÿßÿ∑ŸÑÿßÿπÿßÿ™ Ÿæÿß€åŸá",
                ageLabel: "ÿ≥ŸÜ (€±€∞-€π€π):",
                genderLabel: "ÿ¨ŸÜÿ≥€åÿ™:",
                genderMale: "ŸÖÿ±ÿØ",
                genderFemale: "ÿ≤ŸÜ",
                genderOther: "ÿ≥ÿß€åÿ±/ÿ™ÿ±ÿ¨€åÿ≠ ŸÖ€å‚ÄåÿØŸáŸÖ ŸÜ⁄ØŸà€åŸÖ",
                heightLabel: "ŸÇÿØ (ÿ≥ÿßŸÜÿ™€å‚ÄåŸÖÿ™ÿ±ÿå €±€∞€∞-€≤€µ€∞):",
                weightLabel: "Ÿàÿ≤ŸÜ (⁄©€åŸÑŸà⁄Øÿ±ŸÖÿå €≥€∞-€≤€∞€∞):",
                activityLevelLabel: "ÿ≥ÿ∑ÿ≠ ŸÅÿπÿßŸÑ€åÿ™ (ÿ±Ÿàÿ≤ÿßŸÜŸá):",
                activitySedentary: "⁄©ŸÖ‚Äåÿ™ÿ≠ÿ±⁄© (ÿ®ÿØŸàŸÜ Ÿàÿ±ÿ≤ÿ¥ €åÿß Ÿàÿ±ÿ≤ÿ¥ ⁄©ŸÖ)",
                activityLightly: "ŸÅÿπÿßŸÑ€åÿ™ ÿ≥ÿ®⁄© (Ÿàÿ±ÿ≤ÿ¥ ÿ≥ÿ®⁄© €±-€≥ ÿ±Ÿàÿ≤ ÿØÿ± ŸáŸÅÿ™Ÿá)",
                activityModerately: "ŸÅÿπÿßŸÑ€åÿ™ ŸÖÿ™Ÿàÿ≥ÿ∑ (Ÿàÿ±ÿ≤ÿ¥ ŸÖÿ™Ÿàÿ≥ÿ∑ €≥-€µ ÿ±Ÿàÿ≤ ÿØÿ± ŸáŸÅÿ™Ÿá)",
                activityVery: "ÿ®ÿ≥€åÿßÿ± ŸÅÿπÿßŸÑ (Ÿàÿ±ÿ≤ÿ¥ ÿ≥ŸÜ⁄Ø€åŸÜ €∂-€∑ ÿ±Ÿàÿ≤ ÿØÿ± ŸáŸÅÿ™Ÿá)",
                activityExtra: "ŸÅŸàŸÇ‚ÄåÿßŸÑÿπÿßÿØŸá ŸÅÿπÿßŸÑ (Ÿàÿ±ÿ≤ÿ¥ ÿ®ÿ≥€åÿßÿ± ÿ≥ŸÜ⁄Ø€åŸÜ Ÿà ÿ¥ÿ∫ŸÑ ŸÅ€åÿ≤€å⁄©€å)",
                step2Title: "ŸÖÿ±ÿ≠ŸÑŸá €≤: ÿßŸáÿØÿßŸÅ Ÿà ÿ™ÿ±ÿ¨€åÿ≠ÿßÿ™ ÿπŸÖŸàŸÖ€å",
                goalLabel: "ŸáÿØŸÅ ÿßÿµŸÑ€å:",
                goalFatLoss: "⁄©ÿßŸáÿ¥ ⁄Üÿ±ÿ®€å",
                goalMuscleGain: "ÿßŸÅÿ≤ÿß€åÿ¥ ÿπÿ∂ŸÑŸá",
                goalEndurance: "ÿ®Ÿáÿ®ŸàÿØ ÿßÿ≥ÿ™ŸÇÿßŸÖÿ™",
                goalFlexibility: "ÿßŸÜÿπÿ∑ÿßŸÅ‚ÄåŸæÿ∞€åÿ±€å Ÿà ÿ™ÿ≠ÿ±⁄©",
                goalGeneralHealth: "ÿ≥ŸÑÿßŸÖÿ™ Ÿà ÿ™ŸÜÿßÿ≥ÿ® ÿßŸÜÿØÿßŸÖ ÿπŸÖŸàŸÖ€å",
                timeframeLabel: "⁄Üÿßÿ±⁄ÜŸàÿ® ÿ≤ŸÖÿßŸÜ€å ÿ®ÿ±ÿß€å ŸáÿØŸÅ (ŸÖÿ´ŸÑÿß €¥ ŸáŸÅÿ™Ÿáÿå €≥ ŸÖÿßŸá):",
                timeframePlaceholder: "ŸÖÿ´ŸÑÿß €∏ ŸáŸÅÿ™Ÿá",
                experienceLabel: "ÿ≥ÿ∑ÿ≠ ÿ™ÿ¨ÿ±ÿ®Ÿá Ÿàÿ±ÿ≤ÿ¥€å:",
                expBeginner: "ŸÖÿ®ÿ™ÿØ€å (ÿ™ÿßÿ≤Ÿá Ÿàÿßÿ±ÿØ ÿ®Ÿá Ÿàÿ±ÿ≤ÿ¥ €åÿß ÿ®ÿßÿ≤⁄Øÿ¥ÿ™ Ÿæÿ≥ ÿßÿ≤ ŸÖÿØÿ™ ÿ∑ŸàŸÑÿßŸÜ€å)",
                expIntermediate: "ŸÖÿ™Ÿàÿ≥ÿ∑ (Ÿàÿ±ÿ≤ÿ¥ ŸÖŸÜÿ∏ŸÖ ÿ®ÿ±ÿß€å €∂+ ŸÖÿßŸá)",
                expAdvanced: "Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá (ÿ™ŸÖÿ±€åŸÜ ŸÖŸÜÿ∏ŸÖ Ÿà ÿ≥ÿßÿÆÿ™ÿßÿ±€åÿßŸÅÿ™Ÿá ÿ®ÿ±ÿß€å €±+ ÿ≥ÿßŸÑ)",
                daysPerWeekLabel: "ÿ±Ÿàÿ≤Ÿáÿß€å ÿ™ŸÖÿ±€åŸÜ ÿØÿ± ŸáŸÅÿ™Ÿá (€±-€∑):",
                sessionDurationLabel: "ÿ≠ÿØÿß⁄©ÿ´ÿ± ŸÖÿØÿ™ Ÿáÿ± ÿ¨ŸÑÿ≥Ÿá (ÿØŸÇ€åŸÇŸáÿå €≤€∞-€±€≤€∞):",
                equipmentLabel: "ÿ™ÿ¨Ÿá€åÿ≤ÿßÿ™ ŸÖŸàÿ¨ŸàÿØ:",
                equipNone: "Ÿá€å⁄Ü (ŸÅŸÇÿ∑ Ÿàÿ≤ŸÜ ÿ®ÿØŸÜ)",
                equipBasic: "Ÿæÿß€åŸá (ÿØŸÖÿ®ŸÑÿå ⁄©ÿ¥ ŸÖŸÇÿßŸàŸÖÿ™€å)",
                equipFullGym: "ÿØÿ≥ÿ™ÿ±ÿ≥€å ⁄©ÿßŸÖŸÑ ÿ®Ÿá ÿ®ÿßÿ¥⁄ØÿßŸá",
                step3Title: "ŸÖÿ±ÿ≠ŸÑŸá €≥: ÿ≥ŸÅÿßÿ±ÿ¥€å‚Äåÿ≥ÿßÿ≤€å Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá",
                preferredTypesLabel: "ÿßŸÜŸàÿßÿπ ÿ™ŸÖÿ±€åŸÜ ÿ™ÿ±ÿ¨€åÿ≠€å:",
                typeCardio: "⁄©ÿßÿ±ÿØ€åŸà (ÿØŸà€åÿØŸÜÿå ÿØŸà⁄Üÿ±ÿÆŸá‚Äåÿ≥Ÿàÿßÿ±€åÿå Ÿà ÿ∫€åÿ±Ÿá)",
                typeStrength: "ÿ™ŸÖÿ±€åŸÜ ŸÇÿØÿ±ÿ™€å (Ÿàÿ≤ŸÜŸá)",
                typeBodyweight: "ÿ™ŸÖÿ±€åŸÜÿßÿ™ Ÿàÿ≤ŸÜ ÿ®ÿØŸÜ",
                typeYogaPilates: "€åŸà⁄Øÿß / Ÿæ€åŸÑÿßÿ™ÿ≥",
                typeHIIT: "HIIT (ÿ™ŸÖÿ±€åŸÜ ÿ™ŸÜÿßŸàÿ®€å ÿ®ÿß ÿ¥ÿØÿ™ ÿ®ÿßŸÑÿß)",
                focusAreasLabel: "ŸÜŸàÿßÿ≠€å ÿ™ŸÖÿ±⁄©ÿ≤ (ÿßÿÆÿ™€åÿßÿ±€å):",
                focusUpper: "ÿ®ÿßŸÑÿßÿ™ŸÜŸá",
                focusLower: "Ÿæÿß€å€åŸÜ‚Äåÿ™ŸÜŸá",
                focusCore: "ŸÇÿØÿ±ÿ™ ŸÖÿ±⁄©ÿ≤€å ÿ®ÿØŸÜ",
                focusFlexibility: "ÿßŸÜÿπÿ∑ÿßŸÅ‚ÄåŸæÿ∞€åÿ±€å / ÿ™ÿ≠ÿ±⁄©",
                focusBalance: "ÿ™ÿπÿßÿØŸÑ",
                limitationsLabel: "ŸÖÿ≠ÿØŸàÿØ€åÿ™‚ÄåŸáÿß€å ŸÅ€åÿ≤€å⁄©€å €åÿß ÿ¢ÿ≥€åÿ®‚ÄåÿØ€åÿØ⁄Ø€å‚ÄåŸáÿß (ÿØÿ± ÿµŸàÿ±ÿ™ Ÿàÿ¨ŸàÿØ):",
                limitationsPlaceholder: "ŸÖÿ´ŸÑÿß ÿ≤ÿßŸÜŸàŸáÿß€å ÿ≠ÿ≥ÿßÿ≥ÿå ÿ¢ÿ≥€åÿ®‚ÄåÿØ€åÿØ⁄Ø€å ŸÇÿ®ŸÑ€å ÿ¥ÿßŸÜŸá. ÿØŸÇ€åŸÇ ÿ®ÿßÿ¥€åÿØ.",
                structuringStyleLabel: "ÿ≥ÿ®⁄© ÿ≥ÿßÿÆÿ™ÿßÿ±ÿØŸá€å ÿ™ŸÖÿ±€åŸÜ:",
                styleFullBody: "ÿ±Ÿàÿ™€åŸÜ‚ÄåŸáÿß€å ÿ™ŸÖÿßŸÖ ÿ®ÿØŸÜ",
                styleSplit: "ÿ±Ÿàÿ™€åŸÜ‚ÄåŸáÿß€å ÿ™ŸÅ⁄©€å⁄©€å (ŸÖÿ´ŸÑÿß ŸæŸàÿ¥/ŸæŸàŸÑ/ŸÑ⁄Øÿå ÿ®ÿßŸÑÿßÿ™ŸÜŸá/Ÿæÿß€å€åŸÜ‚Äåÿ™ŸÜŸá)",
                styleFlexible: "ÿ™ÿ±⁄©€åÿ® ÿßŸÜÿπÿ∑ÿßŸÅ‚ÄåŸæÿ∞€åÿ± (ŸáŸàÿ¥ ŸÖÿµŸÜŸàÿπ€å ÿ®Ÿáÿ™ÿ±€åŸÜ ÿ≥ÿßÿÆÿ™ÿßÿ± ÿ±ÿß ÿ™ÿµŸÖ€åŸÖ ŸÖ€å‚Äå⁄Ø€åÿ±ÿØ)",
                includeWarmupCooldownLabel: "Ÿæ€åÿ¥ŸÜŸáÿßÿØÿßÿ™ ⁄Øÿ±ŸÖ ⁄©ÿ±ÿØŸÜ Ÿà ÿ≥ÿ±ÿØ ⁄©ÿ±ÿØŸÜ ⁄ØŸÜÿ¨ÿßŸÜÿØŸá ÿ¥ŸàÿØÿü",
                includeNutritionLabel: "ÿÆŸÑÿßÿµŸá ÿ±ÿßŸáŸÜŸÖÿß€å ÿ™ÿ∫ÿ∞€åŸá Ÿæÿß€åŸá ÿØÿ±ÿÆŸàÿßÿ≥ÿ™ ÿ¥ŸàÿØÿü",
                generatePlanBtnText: "‚ú® ÿß€åÿ¨ÿßÿØ ÿ®ÿ±ŸÜÿßŸÖŸá ÿ¥ÿÆÿµ€å ŸÖŸÜ ‚ú®",
                planResultTitle: "ÿ®ÿ±ŸÜÿßŸÖŸá ÿ™ŸÖÿ±€åŸÜ€å ÿ¥ÿÆÿµ€å ÿ¥ŸÖÿß",
                footerCopyright: "&copy; €≤€∞€≤€µ ÿ®ÿ±ŸÜÿßŸÖŸá‚Äåÿ±€åÿ≤ ÿ™ŸÜÿßÿ≥ÿ® ÿßŸÜÿØÿßŸÖ ŸáŸàÿ¥ ŸÖÿµŸÜŸàÿπ€å. ŸÇÿØÿ±ÿ™ ⁄Øÿ±ŸÅÿ™Ÿá ÿßÿ≤ Gemini.",
                footerDisclaimer: "ÿß€åŸÜ €å⁄© ÿ®ÿ±ŸÜÿßŸÖŸá ŸÜŸÖÿß€åÿ¥€å ÿßÿ≥ÿ™. ŸÇÿ®ŸÑ ÿßÿ≤ ÿ¥ÿ±Ÿàÿπ Ÿáÿ± ÿ®ÿ±ŸÜÿßŸÖŸá ÿ™ŸÜÿßÿ≥ÿ® ÿßŸÜÿØÿßŸÖ ÿ¨ÿØ€åÿØ ÿ®ÿß €å⁄© ŸÖÿ™ÿÆÿµÿµ ŸÖÿ±ÿßŸÇÿ®ÿ™‚ÄåŸáÿß€å ÿ®ŸáÿØÿßÿ¥ÿ™€å ŸÖÿ¥Ÿàÿ±ÿ™ ⁄©ŸÜ€åÿØ.",
                generatingPlanMsg: "üßò ÿØÿ± ÿ≠ÿßŸÑ ÿß€åÿ¨ÿßÿØ ÿ®ÿ±ŸÜÿßŸÖŸá ÿ¥ÿÆÿµ€å ÿ¥ŸÖÿß... ÿß€åŸÜ ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ⁄©ŸÖ€å ÿ∑ŸàŸÑ ÿ®⁄©ÿ¥ÿØ.",
                errorFieldsMsg: "ÿÆÿ∑ÿß! ŸÑÿ∑ŸÅÿß ÿ™ŸÖÿßŸÖ ŸÅ€åŸÑÿØŸáÿß€å ÿßÿ¨ÿ®ÿßÿ±€å ÿ±ÿß ÿ®Ÿá ÿØÿ±ÿ≥ÿ™€å Ÿæÿ± ⁄©ŸÜ€åÿØ.",
                successPlanMsg: "üöÄ ÿ®ÿ±ŸÜÿßŸÖŸá ÿ™ŸÖÿ±€åŸÜ€å ÿ®ÿß ŸÖŸàŸÅŸÇ€åÿ™ ÿß€åÿ¨ÿßÿØ ÿ¥ÿØ! ÿ®ÿ±ÿß€å ŸÖÿ¥ÿßŸáÿØŸá ÿ®Ÿá Ÿæÿß€å€åŸÜ ÿßÿ≥⁄©ÿ±ŸàŸÑ ⁄©ŸÜ€åÿØ.",
                errorApiMsg: "ÿÆÿ∑ÿß: {errorMessage}. ŸÑÿ∑ŸÅÿß Ÿàÿ±ŸàÿØ€å‚ÄåŸáÿß €åÿß ⁄©ŸÑ€åÿØ API ÿÆŸàÿØ ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ÿ±ÿØŸá Ÿà ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.",
                planOverviewTitle: "üìã ŸÜŸÖÿß€å ⁄©ŸÑ€å ÿ®ÿ±ŸÜÿßŸÖŸá",
                totalWeeksText: "ÿ™ÿπÿØÿßÿØ ⁄©ŸÑ ŸáŸÅÿ™Ÿá‚ÄåŸáÿß:",
                workoutsPerWeekText: "ÿ™ŸÖÿ±€åŸÜ ÿØÿ± ŸáŸÅÿ™Ÿá:",
                warmupTitle: "ÿ±Ÿàÿ™€åŸÜ ⁄Øÿ±ŸÖ ⁄©ÿ±ÿØŸÜ",
                cooldownTitle: "ÿ±Ÿàÿ™€åŸÜ ÿ≥ÿ±ÿØ ⁄©ÿ±ÿØŸÜ",
                nutritionTitle: "üçé ÿ±ÿßŸáŸÜŸÖÿß€å ÿ™ÿ∫ÿ∞€åŸá Ÿæÿß€åŸá",
                caloriesEstimateText: "⁄©ÿßŸÑÿ±€å ÿ™ÿÆŸÖ€åŸÜ€å ÿ±Ÿàÿ≤ÿßŸÜŸá:",
                macroBreakdownText: "ÿ™ŸÅ⁄©€å⁄© ŸÖÿß⁄©ÿ±ŸàŸáÿß (Ÿæÿ±Ÿàÿ™ÿ¶€åŸÜ/⁄©ÿ±ÿ®ŸàŸá€åÿØÿ±ÿßÿ™/⁄Üÿ±ÿ®€å):",
                generalAdviceText: "ÿ™Ÿàÿµ€åŸá‚ÄåŸáÿß€å ÿπŸÖŸàŸÖ€å:",
                noExercisesText: "Ÿá€å⁄Ü ÿ™ŸÖÿ±€åŸÜ ÿÆÿßÿµ€å ÿ®ÿ±ÿß€å ÿß€åŸÜ ÿ±Ÿàÿ≤ ŸÑ€åÿ≥ÿ™ ŸÜÿ¥ÿØŸá ÿßÿ≥ÿ™.",
                restDayText: "üòå ÿß€åŸÜ €å⁄© ÿ±Ÿàÿ≤ ÿßÿ≥ÿ™ÿ±ÿßÿ≠ÿ™ ÿ™ÿπ€å€åŸÜ ÿ¥ÿØŸá ÿßÿ≥ÿ™. ÿßÿ≤ ÿ±€å⁄©ÿßŸàÿ±€å ÿÆŸàÿØ ŸÑÿ∞ÿ™ ÿ®ÿ®ÿ±€åÿØ!",
                focusText: "ÿ™ŸÖÿ±⁄©ÿ≤:",
                exercisesTitle: "ÿ™ŸÖÿ±€åŸÜÿßÿ™:",
                setsText: "ÿ≥ÿ™‚ÄåŸáÿß:",
                repsDurationText: "ÿ™⁄©ÿ±ÿßÿ±/ŸÖÿØÿ™:",
                restText: "ÿßÿ≥ÿ™ÿ±ÿßÿ≠ÿ™:",
                noteText: "üí° ŸÜ⁄©ÿ™Ÿá:",
                noPlanDataMsg: "ÿ®ÿßÿ≤€åÿßÿ®€å ÿßÿ∑ŸÑÿßÿπÿßÿ™ ÿ®ÿ±ŸÜÿßŸÖŸá ÿßŸÖ⁄©ÿßŸÜ‚ÄåŸæÿ∞€åÿ± ŸÜÿ®ŸàÿØ.",
                noWorkoutDaysMsg: "Ÿá€å⁄Ü ÿ±Ÿàÿ≤ ÿ™ŸÖÿ±€åŸÜ€å ÿØÿ± ÿ®ÿ±ŸÜÿßŸÖŸá ÿ™ŸàŸÑ€åÿØ ÿ¥ÿØŸá ŸÖÿ¥ÿÆÿµ ŸÜÿ¥ÿØŸá ÿßÿ≥ÿ™."
            }
        };


        // --- Application Logic ---
        const App = {
            currentLanguage: 'en', // Default language

            init: () => {
                fitnessForm.addEventListener('submit', App.handleFormSubmit);
                languageSetting.addEventListener('change', App.handleLanguageChange);
                App.setLanguage(App.currentLanguage); // Apply default language on init
                console.log("Fitness Planner Initialized with Advanced Fields and Language Support");
            },

            setLanguage: (lang) => {
                App.currentLanguage = lang;
                document.documentElement.lang = lang; // Set lang attribute on HTML element
                // Basic implementation: Update text content based on data-translate-key
                document.querySelectorAll('[data-translate-key]').forEach(element => {
                    const key = element.getAttribute('data-translate-key');
                    if (translations[lang] && translations[lang][key]) {
                        if (element.tagName === 'INPUT' && element.placeholder) {
                            element.placeholder = translations[lang][key];
                        } else {
                            element.innerHTML = translations[lang][key]; // Use innerHTML to support emojis in button
                        }
                    }
                });
                // For more complex scenarios (e.g., select options), more specific updates would be needed.
                // Example for select options (can be generalized later)
                App.translateSelectOptions('gender', lang);
                App.translateSelectOptions('activityLevel', lang);
                App.translateSelectOptions('goal', lang);
                App.translateSelectOptions('experienceLevel', lang);
                App.translateSelectOptions('equipment', lang);
                App.translateSelectOptions('structuringStyle', lang);

                 // Adjust text direction for Persian
                if (lang === 'fa') {
                    document.body.dir = 'rtl';
                    // Specific RTL adjustments for layout if needed
                    document.querySelectorAll('.form-section h2 .step-icon').forEach(icon => {
                        icon.style.marginLeft = '0.75rem';
                        icon.style.marginRight = '0';
                    });
                     document.querySelectorAll('.checkbox-group label, .radio-group label').forEach(label => {
                        label.style.marginRight = '0.5rem';
                        label.style.marginLeft = '0';
                    });
                    document.querySelectorAll('.checkbox-item label[for^="include"]').forEach(label => {
                         label.style.marginRight = '0.5rem'; // For checkboxes like "Include Warmup"
                         label.style.marginLeft = '0';
                    });


                } else {
                    document.body.dir = 'ltr';
                    document.querySelectorAll('.form-section h2 .step-icon').forEach(icon => {
                        icon.style.marginRight = '0.75rem';
                        icon.style.marginLeft = '0';
                    });
                    document.querySelectorAll('.checkbox-group label, .radio-group label').forEach(label => {
                        label.style.marginLeft = '0.5rem';
                        label.style.marginRight = '0';
                    });
                     document.querySelectorAll('.checkbox-item label[for^="include"]').forEach(label => {
                         label.style.marginLeft = '0.5rem';
                         label.style.marginRight = '0';
                    });
                }
            },

            translateSelectOptions: (selectId, lang) => {
                const selectElement = document.getElementById(selectId);
                if (selectElement) {
                    Array.from(selectElement.options).forEach(option => {
                        // Construct a key like 'genderMale', 'activitySedentary'
                        // This requires a consistent naming convention in translations object
                        const keyPrefix = selectId.replace(/([A-Z])/g, '_$1').toLowerCase(); // e.g. experienceLevel -> experience_level
                        let optionKeyPart = option.value.replace(/\s+/g, ''); // Remove spaces
                        // Handle specific cases or create a more robust mapping if needed
                        if (selectId === 'gender') optionKeyPart = `gender${optionKeyPart}`;
                        else if (selectId === 'activityLevel') optionKeyPart = `activity${optionKeyPart}`;
                        else if (selectId === 'goal') optionKeyPart = `goal${optionKeyPart.replace('Improvement','').replace('&Mobility','')}`;
                        else if (selectId === 'experienceLevel') optionKeyPart = `exp${optionKeyPart}`;
                        else if (selectId === 'equipment') optionKeyPart = `equip${optionKeyPart.replace('only','').replace('ResistanceBands','').replace('Access','')}`;
                        else if (selectId === 'structuringStyle') optionKeyPart = `style${optionKeyPart.replace('Routines','').replace('(e.g.,Push/Pull/Legs,Upper/Lower)','').replace('(AItodecidebeststructure)','')}`;


                        if (translations[lang] && translations[lang][optionKeyPart]) {
                            option.textContent = translations[lang][optionKeyPart];
                        }
                    });
                }
            },


            handleLanguageChange: (event) => {
                App.setLanguage(event.target.value);
                // console.log("Language changed to:", App.currentLanguage);
                // App.displayMessage(`Language set to ${App.currentLanguage}. UI updated.`, "info");
                // Future: If API supports language, re-prompt or translate plan.
            },

            handleFormSubmit: async (event) => {
                event.preventDefault();
                App.clearMessages();
                const loadingMsgKey = translations[App.currentLanguage]?.generatingPlanMsg || "üßò Generating your personalized plan... This might take a moment.";
                App.displayMessage(loadingMsgKey, "loading");
                generatePlanBtn.disabled = true;
                generatePlanBtn.classList.add('opacity-50', 'cursor-not-allowed');
                planResultArea.classList.add('hidden'); 

                const formData = App.getFormData();
                if (!formData) { 
                    const errorFieldsKey = translations[App.currentLanguage]?.errorFieldsMsg || "Oops! Please fill out all required fields correctly.";
                    App.displayMessage(errorFieldsKey, "error");
                    generatePlanBtn.disabled = false;
                    generatePlanBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    return;
                }

                const prompt = App.buildPrompt(formData);
                const planSchema = App.getPlanSchema();

                try {
                    const apiKey = apiKeyInput.value.trim() || ""; 
                    
                    const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                    const payload = {
                        contents: chatHistory,
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: planSchema,
                            temperature: 0.6, 
                        }
                    };

                    const fullApiUrl = `${GEMINI_API_BASE_URL}?key=${apiKey}`;

                    const response = await fetch(fullApiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({ error: { message: "Unknown API error structure."}}));
                        console.error("API Error Response:", errorData);
                        throw new Error(`API Error: ${response.status} ${response.statusText}. ${errorData?.error?.message || 'Failed to fetch plan details.'}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        
                        const planJsonString = result.candidates[0].content.parts[0].text;
                        const planData = JSON.parse(planJsonString); 
                        
                        App.renderPlan(planData.plan); 
                        const successMsgKey = translations[App.currentLanguage]?.successPlanMsg || "üöÄ Workout plan generated successfully! Scroll down to see it.";
                        App.displayMessage(successMsgKey, "success");
                        planResultArea.classList.remove('hidden');
                        planResultArea.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        console.error("Unexpected API response structure:", result);
                        throw new Error("Failed to get a valid plan from the API. The response structure was not as expected.");
                    }

                } catch (error) {
                    console.error("Error generating plan:", error);
                    let errorApiMsg = translations[App.currentLanguage]?.errorApiMsg || "Error: {errorMessage}. Please check your inputs or API key and try again.";
                    errorApiMsg = errorApiMsg.replace('{errorMessage}', error.message);
                    App.displayMessage(errorApiMsg, "error");
                    planResultArea.classList.add('hidden');
                } finally {
                    generatePlanBtn.disabled = false;
                    generatePlanBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            },

            getFormData: () => {
                const preferredTypes = Array.from(fitnessForm.elements.preferredTypes)
                                           .filter(checkbox => checkbox.checked)
                                           .map(checkbox => checkbox.value);
                const focusAreas = Array.from(fitnessForm.elements.focusAreas)
                                       .filter(checkbox => checkbox.checked)
                                       .map(checkbox => checkbox.value);

                const data = {
                    age: fitnessForm.elements.age.value,
                    gender: fitnessForm.elements.gender.value,
                    height: fitnessForm.elements.height.value,
                    weight: fitnessForm.elements.weight.value,
                    activityLevel: fitnessForm.elements.activityLevel.value,
                    goal: fitnessForm.elements.goal.value,
                    timeframe: fitnessForm.elements.timeframe.value,
                    experienceLevel: fitnessForm.elements.experienceLevel.value,
                    daysPerWeek: fitnessForm.elements.daysPerWeek.value,
                    sessionDuration: fitnessForm.elements.sessionDuration.value,
                    equipment: fitnessForm.elements.equipment.value,
                    preferredTypes: preferredTypes,
                    focusAreas: focusAreas,
                    limitations: fitnessForm.elements.limitations.value.trim(),
                    structuringStyle: fitnessForm.elements.structuringStyle.value,
                    includeWarmupCooldown: fitnessForm.elements.includeWarmupCooldown.checked,
                    includeNutrition: fitnessForm.elements.includeNutrition.checked,
                    currentLanguage: App.currentLanguage // Include current language
                };

                const requiredFields = ['age', 'gender', 'height', 'weight', 'activityLevel', 'goal', 'timeframe', 'experienceLevel', 'daysPerWeek', 'sessionDuration', 'equipment'];
                for (const key of requiredFields) {
                    if (!data[key] && data[key] !== 0) { 
                        console.warn(`Missing required field: ${key}`);
                        const fieldElement = fitnessForm.elements[key];
                        if (fieldElement) {
                            fieldElement.style.borderColor = 'red';
                            fieldElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                        return null; 
                    } else {
                        const fieldElement = fitnessForm.elements[key];
                        if (fieldElement) fieldElement.style.borderColor = ''; 
                    }
                }
                return data;
            },

            buildPrompt: (profile) => {
                // Adding language context to the prompt.
                // The AI should ideally generate the plan in the requested language if capable,
                // or at least be aware of the user's language preference for tone/terminology.
                let languageInstruction = `The user's preferred language is ${profile.currentLanguage === 'fa' ? 'Persian (Farsi)' : 'English'}. If possible, generate the plan details (exercise names, notes) in this language. If not, English is acceptable.`;

                return `You are an expert AI Fitness Coach. ${languageInstruction} Generate a highly personalized and structured workout plan.
User Profile:
- Age: ${profile.age}
- Gender: ${profile.gender}
- Height: ${profile.height} cm
- Weight: ${profile.weight} kg
- Activity Level: ${profile.activityLevel}
- Primary Fitness Goal: ${profile.goal}
- Desired Timeframe: ${profile.timeframe}
- Exercise Experience Level: ${profile.experienceLevel}
- Workout Days Per Week: ${profile.daysPerWeek}
- Maximum Session Duration: ${profile.sessionDuration} minutes
- Equipment Availability: ${profile.equipment}
- Preferred Exercise Types: ${profile.preferredTypes.length > 0 ? profile.preferredTypes.join(', ') : 'AI to decide based on goal'}
- Focus Areas (Optional): ${profile.focusAreas.length > 0 ? profile.focusAreas.join(', ') : 'None specified, focus on primary goal'}
- Physical Limitations/Injuries: ${profile.limitations || 'None reported'}
- Workout Structuring Preference: ${profile.structuringStyle}
- Include Warm-up & Cool-down: ${profile.includeWarmupCooldown ? 'Yes' : 'No'}
- Include Basic Nutrition Guidelines: ${profile.includeNutrition ? 'Yes' : 'No'}

Response Requirements:
1.  Output MUST be a valid JSON object.
2.  The root JSON object must contain a single key "plan".
3.  The "plan" object must contain:
    * "totalWeeks" (Integer): Suggest a suitable number of weeks (e.g., 4, 6, 8, or based on timeframe).
    * "daysPerWeek" (Integer): Match user input (${profile.daysPerWeek}).
    * "days" (Array of DayPlan Objects): Represents the workout schedule for one week. Length should match "daysPerWeek". If daysPerWeek < 7, the array should still represent a 7-day cycle, with appropriate days marked as "Rest Day".
    * "warmupRoutine" (String, Optional): If requested, a brief general warm-up routine.
    * "cooldownRoutine" (String, Optional): If requested, a brief general cool-down routine.
    * "nutritionGuidelines" (Object, Optional): If requested, include this object.
        * "dailyCaloriesEstimate" (String): e.g., "2000-2200 kcal".
        * "macroBreakdown" (Object): { "proteinPct": Number, "carbsPct": Number, "fatsPct": Number } e.g. { "proteinPct": 30, "carbsPct": 40, "fatsPct": 30 }.
        * "generalAdvice" (Array of Strings): e.g., ["Prioritize whole foods.", "Stay hydrated."].
4.  Each DayPlan Object in "days" must have:
    * "dayLabel" (String): e.g., "Day 1 - Monday: Upper Body Strength".
    * "summary" (String): Brief focus, e.g., "Upper Body Strength", "Rest Day".
    * "exercises" (Array of Exercise Objects): Empty if a rest day.
5.  Each Exercise Object must have:
    * "name" (String): e.g., "Barbell Bench Press".
    * "sets" (String): e.g., "3", "3-4".
    * "reps" (String): e.g., "8-12", "30 seconds".
    * "restSeconds" (Integer): e.g., 60, 90.
    * "notes" (String, Optional): Form cues or tips.
6.  Adapt exercises based on limitations. Prioritize safety and effectiveness.
7.  The response must be strictly the JSON object, no additional text.
Example Exercise: { "name": "Push-ups", "sets": "3", "reps": "To failure", "restSeconds": 60, "notes": "Maintain a straight line from head to heels." }
Example Rest Day: { "dayLabel": "Day 2: Rest", "summary": "Rest Day", "exercises": [] }`;
            },

            getPlanSchema: () => {
                // Schema remains largely the same, as the output structure is consistent
                return {
                    type: "OBJECT",
                    properties: {
                        "plan": {
                            type: "OBJECT",
                            properties: {
                                "totalWeeks": { type: "INTEGER", description: "Total number of weeks the plan is designed for." },
                                "daysPerWeek": { type: "INTEGER", description: "Number of workout days per week, matching user input." },
                                "days": {
                                    type: "ARRAY",
                                    description: "Array of day plans, representing a 7-day cycle. Length should be 7, with workout days matching daysPerWeek and others as rest days.",
                                    items: {
                                        type: "OBJECT",
                                        properties: {
                                            "dayLabel": { type: "STRING", description: "Label for the day, e.g., 'Day 1 - Monday: Upper Body' or 'Workout 1: Full Body'" },
                                            "summary": { type: "STRING", description: "Summary of the day's workout or if it's a rest day." },
                                            "exercises": {
                                                type: "ARRAY",
                                                description: "List of exercises for the day. Empty if it's a rest day.",
                                                items: {
                                                    type: "OBJECT",
                                                    properties: {
                                                        "name": { type: "STRING", description: "Name of the exercise." },
                                                        "sets": { type: "STRING", description: "Number of sets, can be a range e.g., '3-4'." },
                                                        "reps": { type: "STRING", description: "Number of reps or duration, e.g., '8-12' or '30 seconds'." },
                                                        "restSeconds": { type: "INTEGER", description: "Rest duration in seconds between sets." },
                                                        "notes": { type: "STRING", nullable: true, description: "Optional notes or tips for the exercise." }
                                                    },
                                                    required: ["name", "sets", "reps", "restSeconds"]
                                                }
                                            }
                                        },
                                        required: ["dayLabel", "summary", "exercises"]
                                    }
                                },
                                "warmupRoutine": { type: "STRING", nullable: true, description: "General warm-up routine if requested." },
                                "cooldownRoutine": { type: "STRING", nullable: true, description: "General cool-down routine if requested." },
                                "nutritionGuidelines": {
                                    type: "OBJECT",
                                    nullable: true,
                                    description: "Basic nutrition guidelines if requested.",
                                    properties: {
                                        "dailyCaloriesEstimate": { type: "STRING", description: "Estimated daily calorie intake, e.g., '2000-2200 kcal'." },
                                        "macroBreakdown": {
                                            type: "OBJECT",
                                            properties: {
                                                "proteinPct": { type: "INTEGER", description: "Percentage of protein." },
                                                "carbsPct": { type: "INTEGER", description: "Percentage of carbohydrates." },
                                                "fatsPct": { type: "INTEGER", description: "Percentage of fats." }
                                            },
                                            required: ["proteinPct", "carbsPct", "fatsPct"]
                                        },
                                        "generalAdvice": {
                                            type: "ARRAY",
                                            items: { type: "STRING" },
                                            description: "List of general nutrition tips."
                                        }
                                    },
                                     required: ["dailyCaloriesEstimate", "macroBreakdown", "generalAdvice"]
                                }
                            },
                            required: ["totalWeeks", "daysPerWeek", "days"]
                        }
                    },
                    required: ["plan"]
                };
            },

            renderPlan: (planData) => {
                planContent.innerHTML = ''; 
                const currentLang = App.currentLanguage;

                if (!planData) {
                    planContent.innerHTML = `<p class="text-gray-600">${translations[currentLang]?.noPlanDataMsg || 'Could not retrieve plan data.'}</p>`;
                    return;
                }

                const planHeader = document.createElement('div');
                planHeader.className = 'mb-6 p-6 bg-indigo-50 rounded-xl border border-indigo-200 shadow';
                planHeader.innerHTML = `
                    <h3 class="text-2xl font-bold text-indigo-700 mb-3">${translations[currentLang]?.planOverviewTitle || 'üìã Plan Overview'}</h3>
                    <p class="text-indigo-600 text-md"><strong>${translations[currentLang]?.totalWeeksText || 'Total Weeks:'}</strong> ${planData.totalWeeks || 'Not specified'}</p>
                    <p class="text-indigo-600 text-md"><strong>${translations[currentLang]?.workoutsPerWeekText || 'Workouts Per Week:'}</strong> ${planData.daysPerWeek || 'Not specified'}</p>
                `;
                planContent.appendChild(planHeader);

                if (planData.warmupRoutine) {
                    const warmupCard = document.createElement('div');
                    warmupCard.className = 'plan-card bg-green-50 border-green-200';
                    warmupCard.innerHTML = `
                        <h3 class="text-xl font-semibold text-green-700">${translations[currentLang]?.warmupTitle || 'Warm-up Routine'}</h3>
                        <p class="text-green-600 whitespace-pre-line">${planData.warmupRoutine}</p>
                    `;
                    planContent.appendChild(warmupCard);
                }

                if (planData.days && planData.days.length > 0) {
                    planData.days.forEach(day => {
                        const dayCard = document.createElement('div');
                        dayCard.className = 'plan-card';

                        let exercisesHTML = `<p class="text-sm text-gray-500">${translations[currentLang]?.noExercisesText || 'No specific exercises listed for this day.'}</p>`;
                        if (day.exercises && day.exercises.length > 0) {
                            exercisesHTML = '<ul class="divide-y divide-gray-100">';
                            day.exercises.forEach(ex => {
                                exercisesHTML += `
                                    <li class="exercise-item py-4">
                                        <p class="font-semibold text-lg text-gray-800">${ex.name}</p>
                                        <p class="text-sm text-gray-600">
                                            <strong>${translations[currentLang]?.setsText || 'Sets:'}</strong> ${ex.sets}, 
                                            <strong>${translations[currentLang]?.repsDurationText || 'Reps/Duration:'}</strong> ${ex.reps}, 
                                            <strong>${translations[currentLang]?.restText || 'Rest:'}</strong> ${ex.restSeconds}s
                                        </p>
                                        ${ex.notes ? `<p class="text-xs text-gray-500 mt-1 bg-gray-50 p-2 rounded"><em>${translations[currentLang]?.noteText || 'üí° Note:'} ${ex.notes}</em></p>` : ''}
                                    </li>`;
                            });
                            exercisesHTML += '</ul>';
                        } else if (day.summary && (day.summary.toLowerCase().includes("rest") || day.summary.toLowerCase().includes("ÿßÿ≥ÿ™ÿ±ÿßÿ≠ÿ™"))) {
                             exercisesHTML = `<p class="text-md text-emerald-600 font-medium py-3">${translations[currentLang]?.restDayText || 'üòå This is a designated rest day. Enjoy your recovery!'}</p>`;
                        }

                        dayCard.innerHTML = `
                            <h3 class="text-xl font-semibold text-indigo-700 border-b border-indigo-200 pb-2 mb-4">${day.dayLabel}</h3>
                            <p class="text-md text-gray-700 mb-4"><strong>${translations[currentLang]?.focusText || 'Focus:'}</strong> ${day.summary}</p>
                            <h4 class="text-lg font-medium text-indigo-600">${translations[currentLang]?.exercisesTitle || 'Exercises:'}</h4>
                            ${exercisesHTML}
                        `;
                        planContent.appendChild(dayCard);
                    });
                } else {
                     planContent.innerHTML += `<p class="text-gray-600 p-4 text-center">${translations[currentLang]?.noWorkoutDaysMsg || 'No workout days were specified in the generated plan.'}</p>`;
                }
                
                if (planData.cooldownRoutine) {
                    const cooldownCard = document.createElement('div');
                    cooldownCard.className = 'plan-card bg-sky-50 border-sky-200';
                    cooldownCard.innerHTML = `
                        <h3 class="text-xl font-semibold text-sky-700">${translations[currentLang]?.cooldownTitle || 'Cool-down Routine'}</h3>
                        <p class="text-sky-600 whitespace-pre-line">${planData.cooldownRoutine}</p>
                    `;
                    planContent.appendChild(cooldownCard);
                }

                if (planData.nutritionGuidelines) {
                    const nutrition = planData.nutritionGuidelines;
                    const nutritionCard = document.createElement('div');
                    nutritionCard.className = 'plan-card bg-orange-50 border-orange-200';
                    let adviceHTML = '';
                    if (nutrition.generalAdvice && nutrition.generalAdvice.length > 0) {
                        adviceHTML = '<ul>' + nutrition.generalAdvice.map(adv => `<li class="ml-4 list-disc text-orange-600">${adv}</li>`).join('') + '</ul>';
                         if(App.currentLanguage === 'fa') { // Adjust list style for RTL
                            adviceHTML = '<ul class="mr-4">' + nutrition.generalAdvice.map(adv => `<li class="list-disc text-orange-600">${adv}</li>`).join('') + '</ul>';
                        }
                    }
                    nutritionCard.innerHTML = `
                        <h3 class="text-xl font-semibold text-orange-700">${translations[currentLang]?.nutritionTitle || 'üçé Basic Nutrition Guidelines'}</h3>
                        <p class="text-orange-600"><strong>${translations[currentLang]?.caloriesEstimateText || 'Estimated Daily Calories:'}</strong> ${nutrition.dailyCaloriesEstimate || 'Not specified'}</p>
                        ${nutrition.macroBreakdown ? `<p class="text-orange-600"><strong>${translations[currentLang]?.macroBreakdownText || 'Macro Breakdown (P/C/F):'}</strong> ${nutrition.macroBreakdown.proteinPct}% / ${nutrition.macroBreakdown.carbsPct}% / ${nutrition.macroBreakdown.fatsPct}%</p>` : ''}
                        ${adviceHTML ? `<h5 class="font-semibold mt-2 text-orange-700">${translations[currentLang]?.generalAdviceText || 'General Advice:'}</h5>${adviceHTML}` : ''}
                    `;
                    planContent.appendChild(nutritionCard);
                }
            },

            displayMessage: (message, type = "info") => { 
                messageArea.innerHTML = ''; 
                const messageDiv = document.createElement('div');
                messageDiv.className = `message-box ${type} flex items-center`; 
                let icon = '';
                if (type === 'error') icon = '<span class="mr-2 text-lg">‚ö†Ô∏è</span>';
                if (type === 'success') icon = '<span class="mr-2 text-lg">‚úÖ</span>';
                if (type === 'loading') icon = '<span class="mr-2 text-lg animate-spin">‚è≥</span>'; 
                 if (App.currentLanguage === 'fa' && icon) { // Adjust icon margin for RTL
                    icon = icon.replace('mr-2', 'ml-2');
                }
                
                messageDiv.innerHTML = icon + message;
                messageArea.appendChild(messageDiv);
            },

            clearMessages: () => {
                messageArea.innerHTML = '';
            }
        };

        // --- Initialize Application ---
        document.addEventListener('DOMContentLoaded', App.init);

    </script>
</body>
</html>
